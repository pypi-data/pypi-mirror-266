(()=>{function g(r,o,t){t.forEach(([l,a])=>{if(l==="getData"){console.log("custom call"),Shiny.onInputChange(`${r.id}_data`,o.getData());return}if(l==="deleteSelectedRows"){console.log("custom call"),o.getSelectedRows().forEach(c=>{console.log(c.getIndex()),o.deleteRow(c.getIndex())});return}console.log(l,a),o[l](...a)})}var d=class extends Shiny.OutputBinding{find(o){return o.find(".shiny-tabulator-output")}renderValue(o,t){console.log("payload",t);let l=t.options!==void 0?t.options.editor:!1,a=t.schema.fields.map(n=>({title:n.name,field:n.name,hozAlign:["integer","number"].includes(n.type)?"right":"left",editor:l}));t.options.movableRows===!0&&(a=[{rowHandle:!0,formatter:"handle",headerSort:!1,frozen:!0,width:30,minWidth:30}].concat(a)),t.options.columns==null&&(t.options.columns=a),t.options.download&&(t.options.footerElement="<button id='tabulator-download-csv' class='tabulator-page'>Download csv</button>");let e=new Tabulator(o,Object.assign({data:t.data,layout:"fitColumns"},t.options));e.on("rowClick",function(n,s){let i=`${o.id}_row_clicked`;console.log(i,s.getData()),Shiny.onInputChange(i,s.getData())}),e.on("rowClick",(n,s)=>{let i=`${o.id}_rows_selected`,u=e.getSelectedRows().map(f=>f.getData());console.log(i,u),Shiny.onInputChange(i,u)}),e.on("cellEdited",function(n){let s=`${o.id}_row_edited`;console.log(s,n.getData()),Shiny.onInputChange(s,n.getData())}),e.on("dataFiltered",function(n,s){let i=s.map(u=>u.getData());console.log(i),Shiny.onInputChange(`${o.id}_data_filtered`,i)}),e.on("tableBuilt",function(){t.options.columnUpdates!=null&&console.log("column updates",t.options.columnUpdates);let n=document.getElementById("tabulator-download-csv");n&&n.addEventListener("click",()=>e.download("csv","data.csv"))});let c=`tabulator-${o.id}`;Shiny.addCustomMessageHandler(c,n=>{console.log(n),g(o,e,n.calls)})}};Shiny.outputBindings.register(new d,"shiny-tabulator-output");})();
