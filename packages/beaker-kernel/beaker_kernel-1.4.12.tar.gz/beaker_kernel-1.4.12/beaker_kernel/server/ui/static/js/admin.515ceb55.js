(function(){"use strict";var e={4335:function(e,a,t){var r=t(49242),i=t(17729),n=t(73396),l=t(44870),s=t(87139),o=t(46501),d=t(76252),u=t(63618),c=t(26250),f=t(18193),m=t(66066),v=t(68595),p=t(27046),h=t(53435);const _={id:"admin"},U=(0,n._)("h1",{style:{"text-align":"center"}},"Beaker admin",-1),b={style:{"margin-right":"3rem",display:"flex","justify-content":"right","justify-items":"center"}},S={style:{"margin-top":"auto","margin-bottom":"auto","font-weight":"bolder","font-size":"larger"}},g={class:"stats"},w=(0,n._)("h2",null,"Stats",-1),y={class:"stats-tables"},Z=(0,n._)("div",{class:"header"},[(0,n._)("span",{class:"header-title"},"File Handles")],-1),W=(0,n._)("div",{class:"header"},[(0,n._)("span",{class:"header-title"},"Load")],-1),k=(0,n._)("div",{class:"header"},[(0,n._)("span",{class:"header-title"},"Memory")],-1),j=(0,n._)("div",{class:"header"},[(0,n._)("span",{class:"header-title"},"Disk")],-1),x=(0,n._)("h2",null,"Sessions",-1),C={class:"header"},O=(0,n._)("span",{class:"header-title"},"Sessions",-1),P=(0,n._)("span",{style:{flex:"100"}},null,-1),T={style:{"font-size":"large"}},D=(0,n._)("span",{style:{padding:"0 1rem"}}," | ",-1),M=(0,n._)("h4",null,[(0,n.Uk)("Process details "),(0,n._)("span",{style:{"font-size":"smaller","margin-left":"3rem"}},"(Note: CPU and Memory usage may be reflected mulitple times due to parent/child relational reporting)")],-1);var F=(0,n.aZ)({__name:"BeakerAdmin",props:["config"],setup(e){const a=(0,p.N)(),t=(0,h.p)(),r=o.PageConfig.getBaseUrl(),i=(0,l.iH)({}),F=(0,l.iH)(),L=(0,l.iH)("never"),E=(0,l.iH)("---"),H=(0,l.iH)([]),I=(0,l.iH)([]),z=(0,n.Fl)((()=>{const e=i.value.sessions?.map((e=>({beaker_id:e.path,raw_id:e.id,beaker_kernel:e.kernel.id,last_active:e.kernel.last_activity,idle:((Date.now()-Date.parse(e.kernel.last_activity))/6e4).toFixed(2),connected:e.kernel.connections>0,process_info:e.process_info})));return e})),B=async()=>{const e=o.URLExt.join(r,"/stats"),a=await fetch(e);i.value=await a.json(),L.value=(new Date).toUTCString()},R=async e=>{for(const a of e){const e=o.URLExt.join(r,"/api/sessions/",a),n=await fetch(e,{method:"DELETE",headers:{Authorization:`token ${i.value.token}`}});if(!n.ok){const e=await n.text();t.add({severity:"error",summary:"Error removing session",detail:`${n.status} ${n.statusText} - ${e}`,life:3e3})}}await B()},$=()=>{0!==H.value.length&&"---"!==E.value&&"destroy"===E.value&&A(H.value)},A=e=>{a.require({message:`Are you sure you want to proceed? This will destroy session(s): ${e.map((e=>e.beaker_id)).join(", ")}`,header:"Confirmation",icon:"pi pi-exclamation-triangle",rejectClass:"p-button-secondary p-button-outlined",rejectLabel:"Cancel",acceptLabel:"Confirm",accept:async()=>{await R(e.map((e=>e.raw_id)))},reject:()=>{}})};return(0,n.wF)((()=>{B(),F.value=window.setInterval(B,6e4)})),(0,n.Jd)((()=>{clearInterval(F.value)})),(e,a)=>((0,n.wg)(),(0,n.iD)(n.HY,null,[(0,n.Wm)((0,l.SU)(f.Z)),(0,n._)("div",_,[(0,n._)("div",null,[U,(0,n._)("div",b,[(0,n._)("span",S,"Last updated: "+(0,s.zw)(L.value),1),(0,n.Wm)((0,l.SU)(u.Z),{icon:"pi pi-refresh",style:{"margin-left":"1rem"},raised:"",onClick:a[0]||(a[0]=e=>B())})])]),(0,n._)("div",g,[w,(0,n._)("div",y,[(0,n.Wm)((0,l.SU)(d.Z),{value:[i.value.file_handles]},{header:(0,n.w5)((()=>[Z])),default:(0,n.w5)((()=>[(0,n.Wm)((0,l.SU)(c.Z),{field:"open",header:"Open"}),(0,n.Wm)((0,l.SU)(c.Z),{field:"total",header:"Total"}),(0,n.Wm)((0,l.SU)(c.Z),{field:"usage",header:"Usage"})])),_:1},8,["value"]),(0,n.Wm)((0,l.SU)(d.Z),{value:[i.value.load]},{header:(0,n.w5)((()=>[W])),default:(0,n.w5)((()=>[(0,n.Wm)((0,l.SU)(c.Z),{field:"1_min",header:"1 Min"}),(0,n.Wm)((0,l.SU)(c.Z),{field:"5_min",header:"5 Min"}),(0,n.Wm)((0,l.SU)(c.Z),{field:"15_min",header:"15 Min"})])),_:1},8,["value"]),(0,n.Wm)((0,l.SU)(d.Z),{value:[i.value.memory]},{header:(0,n.w5)((()=>[k])),default:(0,n.w5)((()=>[(0,n.Wm)((0,l.SU)(c.Z),{field:"total",header:"Total"}),(0,n.Wm)((0,l.SU)(c.Z),{field:"used",header:"Used"}),(0,n.Wm)((0,l.SU)(c.Z),{field:"free",header:"Free"}),(0,n.Wm)((0,l.SU)(c.Z),{field:"usage",header:"Usage"})])),_:1},8,["value"]),(0,n.Wm)((0,l.SU)(d.Z),{value:[i.value.disk]},{header:(0,n.w5)((()=>[j])),default:(0,n.w5)((()=>[(0,n.Wm)((0,l.SU)(c.Z),{field:"total",header:"Total"}),(0,n.Wm)((0,l.SU)(c.Z),{field:"used",header:"Used"}),(0,n.Wm)((0,l.SU)(c.Z),{field:"free",header:"Free"}),(0,n.Wm)((0,l.SU)(c.Z),{field:"usage",header:"Usage"})])),_:1},8,["value"])])]),(0,n._)("div",null,[x,(0,n.Wm)((0,l.SU)(d.Z),{value:z.value,selection:H.value,"onUpdate:selection":a[2]||(a[2]=e=>H.value=e),"expanded-rows":I.value,"onUpdate:expandedRows":a[3]||(a[3]=e=>I.value=e),"striped-rows":!0,removableSort:""},{header:(0,n.w5)((()=>[(0,n._)("div",C,[O,P,(0,n._)("span",T,"Session count: "+(0,s.zw)(i.value.sessions?.length||0),1),D,(0,n.Wm)((0,l.SU)(m.Z),{options:["---","destroy"],modelValue:E.value,"onUpdate:modelValue":a[1]||(a[1]=e=>E.value=e)},null,8,["modelValue"]),(0,n.Wm)((0,l.SU)(u.Z),{severity:"success",raised:"",onClick:$},{default:(0,n.w5)((()=>[(0,n.Uk)("Go")])),_:1})])])),expansion:(0,n.w5)((({data:e})=>[(0,n._)("div",null,[M,(0,n.Wm)((0,l.SU)(d.Z),{value:e.process_info,"striped-rows":!0,removableSort:""},{default:(0,n.w5)((()=>[(0,n.Wm)((0,l.SU)(c.Z),{field:"pid",header:"PID",sortable:""}),(0,n.Wm)((0,l.SU)(c.Z),{field:"ppid",header:"Parent PID",sortable:""}),(0,n.Wm)((0,l.SU)(c.Z),{field:"cpu_pct",header:"CPU Usage %",sortable:""}),(0,n.Wm)((0,l.SU)(c.Z),{field:"cputime",header:"Cumulative CPU Time",sortable:""}),(0,n.Wm)((0,l.SU)(c.Z),{field:"mem_pct",header:"Mem Usage (%)",sortable:""}),(0,n.Wm)((0,l.SU)(c.Z),{field:"mem_bytes",header:"Mem Usage (bytes)",sortable:""}),(0,n.Wm)((0,l.SU)(c.Z),{field:"threads",header:"Thread count",sortable:""}),(0,n.Wm)((0,l.SU)(c.Z),{field:"open_files",header:"File handles",sortable:""}),(0,n.Wm)((0,l.SU)(c.Z),{field:"cmd",header:"Full command",sortable:""})])),_:2},1032,["value"])])])),default:(0,n.w5)((()=>[(0,n.Wm)((0,l.SU)(c.Z),{"selection-mode":"multiple"}),(0,n.Wm)((0,l.SU)(c.Z),{expander:"",style:{width:"5rem"}}),(0,n.Wm)((0,l.SU)(c.Z),{field:"beaker_id",header:"Beaker ID",sortable:""}),(0,n.Wm)((0,l.SU)(c.Z),{field:"raw_id",header:"Raw ID",sortable:""}),(0,n.Wm)((0,l.SU)(c.Z),{field:"beaker_kernel",header:"Beaker Kernel",sortable:""}),(0,n.Wm)((0,l.SU)(c.Z),{field:"last_active",header:"Last Active",sortable:""}),(0,n.Wm)((0,l.SU)(c.Z),{field:"idle",header:"Idle Duration (minutes)",sortable:""}),(0,n.Wm)((0,l.SU)(c.Z),{field:"connected",header:"User connected",sortable:""}),(0,n.Wm)((0,l.SU)(c.Z),{header:"Destroy"},{body:(0,n.w5)((({data:e})=>[(0,n.Wm)((0,l.SU)(u.Z),{icon:"pi pi-times",severity:"danger",raised:"",onClick:a=>A([{beaker_id:e.beaker_id,raw_id:e.raw_id}])},null,8,["onClick"])])),_:1})])),_:1},8,["value","selection","expanded-rows"])])]),(0,n.Wm)((0,l.SU)(v.Z),{position:"bottom-right"})],64))}});const L=F;var E=L,H=t(46720),I=t(79511),z=t(23689),B=t(88459);const R=o.PageConfig.getBaseUrl();(async()=>{let e;{const a=o.URLExt.join(R,"/config"),t=await fetch(a);e=await t.json()}const a=(0,r.ri)(E,{config:e});a.use(i.ZP),a.use(I.Z),a.use(B.Z),a.directive("tooltip",H.Z),a.directive("focustrap",z.Z),a.mount("#app")})()}},a={};function t(r){var i=a[r];if(void 0!==i)return i.exports;var n=a[r]={exports:{}};return e[r].call(n.exports,n,n.exports,t),n.exports}t.m=e,function(){var e=[];t.O=function(a,r,i,n){if(!r){var l=1/0;for(u=0;u<e.length;u++){r=e[u][0],i=e[u][1],n=e[u][2];for(var s=!0,o=0;o<r.length;o++)(!1&n||l>=n)&&Object.keys(t.O).every((function(e){return t.O[e](r[o])}))?r.splice(o--,1):(s=!1,n<l&&(l=n));if(s){e.splice(u--,1);var d=i();void 0!==d&&(a=d)}}return a}n=n||0;for(var u=e.length;u>0&&e[u-1][2]>n;u--)e[u]=e[u-1];e[u]=[r,i,n]}}(),function(){t.n=function(e){var a=e&&e.__esModule?function(){return e["default"]}:function(){return e};return t.d(a,{a:a}),a}}(),function(){t.d=function(e,a){for(var r in a)t.o(a,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:a[r]})}}(),function(){t.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){t.o=function(e,a){return Object.prototype.hasOwnProperty.call(e,a)}}(),function(){t.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){t.j=328}(),function(){t.p="/"}(),function(){var e={328:0};t.O.j=function(a){return 0===e[a]};var a=function(a,r){var i,n,l=r[0],s=r[1],o=r[2],d=0;if(l.some((function(a){return 0!==e[a]}))){for(i in s)t.o(s,i)&&(t.m[i]=s[i]);if(o)var u=o(t)}for(a&&a(r);d<l.length;d++)n=l[d],t.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return t.O(u)},r=self["webpackChunkbeaker_vue"]=self["webpackChunkbeaker_vue"]||[];r.forEach(a.bind(null,0)),r.push=a.bind(null,r.push.bind(r))}();var r=t.O(void 0,[998],(function(){return t(4335)}));r=t.O(r)})();
//# sourceMappingURL=admin.515ceb55.js.map