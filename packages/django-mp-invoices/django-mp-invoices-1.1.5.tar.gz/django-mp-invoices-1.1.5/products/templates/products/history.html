

{% extends 'admin/base.html' %}

{% load i18n widget_tweaks %}


{% block content %}

    {{ block.super }}

    <h4 class="pull-left">
        {% trans 'History' %} | {{ product.name }}
        <small>
            ({% trans 'Created' %}: {{ product.created|date:'d.m.Y' }})
        </small>
    </h4>

    <div class="clearfix"></div>

    <form class="filter-form" data-role="filter-form">
        {{ form.errors }}
        <div class="row">
            <div class="col-md-6">
                {{ form.date_from|add_class:'form-control'|attr:'autocomplete:off' }}
            </div>
            <div class="col-md-6">
                {{ form.date_to|add_class:'form-control'|attr:'autocomplete:off' }}
            </div>
        </div>
    </form>

    <div class="clearfix"></div>

    {% include 'invoices/history.html' %}

    <h4>{% trans 'History' %}</h4>

    <table class="table table-bordered table-condensed">
        <thead>
            <tr>
                <th>{% trans 'Action' %}</th>
                <th>{% trans 'Date' %}</th>
                <th>{% trans 'Quantity' %}</th>
                <th>{% trans 'Price' %}</th>
                <th>{% trans 'Subtotal (Retail)' %}</th>
            </tr>
        </thead>
        <tbody>
            {% for item in all_items %}
                <tr>
                    <td>{{ item.invoice.get_type_display }}</td>
                    <td>
                        <a href="{{ item.invoice.manage_url }}">
                            {{ item.invoice.created }}
                        </a>
                    </td>
                    <td>{{ item.qty }}</td>
                    <td>{{ item.price_with_discount|stringformat:".2f" }}</td>
                    <td>{{ item.subtotal_with_discount|stringformat:".2f" }}</td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
{% endblock %}


{% block js %}
    {{ block.super }}
    <script>
        (function ($) {
            var $form = $('[data-role=filter-form]');
            $form.find('input').change(function () {
                $form.submit();
            });
        })(jQuery);
    </script>
{% endblock %}
