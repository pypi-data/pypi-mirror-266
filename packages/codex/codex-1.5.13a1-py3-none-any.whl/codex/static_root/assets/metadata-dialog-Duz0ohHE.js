import{x as ae,E as fe,bJ as He,G as ue,av as We,au as E,K as de,L as s,_ as U,R as d,O as B,aK as Ne,az as ce,P as _,aL as Re,am as X,bK as Xe,bL as Ze,h as v,bM as Se,J as pe,s as Ce,r as he,S as Je,p as Qe,bN as Fe,bO as et,i as Ee,bP as tt,aj as at,z as W,be as Te,bf as lt,bQ as st,bh as rt,bR as ot,bS as it,at as we,ar as nt,al as be,aa as D,ae as T,ak as ie,bT as ut,bU as dt,M as ee,ay as w,bV as ct,ab as ge,aB as M,bW as mt,a$ as De,N as ne,aD as m,ad as te,Q as Le,l as vt,a_ as $e,bt as ht,bX as ft,ax as pt,m as bt,b8 as gt,b9 as yt,b4 as Ve,k as kt,b5 as _t,b7 as St,aR as Ct,aX as Tt,aI as wt,aJ as Vt}from"./admin-drawer-panel-BaTVOySr.js";import{a as Bt,g as Pt,h as It,j as Mt}from"./VToolbar-DGnoHqIM.js";import{m as Nt,a as Rt,u as Ft,V as Be,b as Et}from"./VSelectionControl-Cw_49nCw.js";import{C as Dt,u as Y,A as Lt}from"./main-BZTHWXBZ.js";import{c as $t,d as Ot}from"./VSelect-BVPuxXum.js";import{c as At}from"./to-case-kUm8NPpW.js";import{V as jt}from"./confirm-footer-DtV70TTy.js";const zt=ae({...fe(),...He({variant:"text"})},"VToolbarItems"),Cl=ue()({name:"VToolbarItems",props:zt(),setup(e,t){let{slots:a}=t;return We({VBtn:{color:E(e,"color"),height:"inherit",variant:E(e,"variant")}}),de(()=>{var o;return s("div",{class:["v-toolbar-items",e.class],style:e.style},[(o=a.default)==null?void 0:o.call(a)])}),{}}}),Ut={name:"PaginationToolbar"};function qt(e,t,a,o,i,l){return d(),B(Bt,{class:"paginationToolbar codexToolbar",density:"compact",transform:"center bottom"},Ne({_:2},[ce(e.$slots,(n,r)=>({name:r,fn:_(c=>[Re(e.$slots,r,X({props:n},c),void 0,!0)])}))]),1024)}const Tl=U(Ut,[["render",qt],["__scopeId","data-v-cfa8cce0"]]),ye=Symbol.for("vuetify:v-slider");function Gt(e,t,a){const o=a==="vertical",i=t.getBoundingClientRect(),l="touches"in e?e.touches[0]:e;return o?l.clientY-(i.top+i.height/2):l.clientX-(i.left+i.width/2)}function Kt(e,t){return"touches"in e&&e.touches.length?e.touches[0][t]:"changedTouches"in e&&e.changedTouches.length?e.changedTouches[0][t]:e[t]}const Yt=ae({disabled:{type:Boolean,default:null},error:Boolean,readonly:{type:Boolean,default:null},max:{type:[Number,String],default:100},min:{type:[Number,String],default:0},step:{type:[Number,String],default:0},thumbColor:String,thumbLabel:{type:[Boolean,String],default:void 0,validator:e=>typeof e=="boolean"||e==="always"},thumbSize:{type:[Number,String],default:20},showTicks:{type:[Boolean,String],default:!1,validator:e=>typeof e=="boolean"||e==="always"},ticks:{type:[Array,Object]},tickSize:{type:[Number,String],default:2},color:String,trackColor:String,trackFillColor:String,trackSize:{type:[Number,String],default:4},direction:{type:String,default:"horizontal",validator:e=>["vertical","horizontal"].includes(e)},reverse:Boolean,...Xe(),...Ze({elevation:2}),ripple:{type:Boolean,default:!0}},"Slider"),xt=e=>{const t=v(()=>parseFloat(e.min)),a=v(()=>parseFloat(e.max)),o=v(()=>+e.step>0?parseFloat(e.step):0),i=v(()=>Math.max(Se(o.value),Se(t.value)));function l(n){if(n=parseFloat(n),o.value<=0)return n;const r=Fe(n,t.value,a.value),c=t.value%o.value,h=Math.round((r-c)/o.value)*o.value+c;return parseFloat(Math.min(h,a.value).toFixed(i.value))}return{min:t,max:a,step:o,decimals:i,roundValue:l}},Ht=e=>{let{props:t,steps:a,onSliderStart:o,onSliderMove:i,onSliderEnd:l,getActiveThumb:n}=e;const{isRtl:r}=pe(),c=E(t,"reverse"),h=v(()=>t.direction==="vertical"),P=v(()=>h.value!==c.value),{min:k,max:p,step:L,decimals:q,roundValue:A}=a,x=v(()=>parseInt(t.thumbSize,10)),G=v(()=>parseInt(t.tickSize,10)),j=v(()=>parseInt(t.trackSize,10)),$=v(()=>(p.value-k.value)/L.value),H=E(t,"disabled"),O=v(()=>t.error||t.disabled?void 0:t.thumbColor??t.color),b=v(()=>t.error||t.disabled?void 0:t.trackColor??t.color),N=v(()=>t.error||t.disabled?void 0:t.trackFillColor??t.color),S=Ce(!1),C=Ce(0),R=he(),F=he();function f(u){var _e;const y=t.direction==="vertical",Ue=y?"top":"left",qe=y?"height":"width",Ge=y?"clientY":"clientX",{[Ue]:Ke,[qe]:Ye}=(_e=R.value)==null?void 0:_e.$el.getBoundingClientRect(),xe=Kt(u,Ge);let ve=Math.min(Math.max((xe-Ke-C.value)/Ye,0),1)||0;return(y?P.value:P.value!==r.value)&&(ve=1-ve),A(k.value+ve*(p.value-k.value))}const z=u=>{l({value:f(u)}),S.value=!1,C.value=0},K=u=>{F.value=n(u),F.value&&(F.value.focus(),S.value=!0,F.value.contains(u.target)?C.value=Gt(u,F.value,t.direction):(C.value=0,i({value:f(u)})),o({value:f(u)}))},I={passive:!0,capture:!0};function Z(u){i({value:f(u)})}function le(u){u.stopPropagation(),u.preventDefault(),z(u),window.removeEventListener("mousemove",Z,I),window.removeEventListener("mouseup",le)}function se(u){var y;z(u),window.removeEventListener("touchmove",Z,I),(y=u.target)==null||y.removeEventListener("touchend",se)}function me(u){var y;K(u),window.addEventListener("touchmove",Z,I),(y=u.target)==null||y.addEventListener("touchend",se,{passive:!1})}function V(u){u.preventDefault(),K(u),window.addEventListener("mousemove",Z,I),window.addEventListener("mouseup",le,{passive:!1})}const g=u=>{const y=(u-k.value)/(p.value-k.value)*100;return Fe(isNaN(y)?0:y,0,100)},J=E(t,"showTicks"),Q=v(()=>J.value?t.ticks?Array.isArray(t.ticks)?t.ticks.map(u=>({value:u,position:g(u),label:u.toString()})):Object.keys(t.ticks).map(u=>({value:parseFloat(u),position:g(parseFloat(u)),label:t.ticks[u]})):$.value!==1/0?Je($.value+1).map(u=>{const y=k.value+u*L.value;return{value:y,position:g(y)}}):[]:[]),re=v(()=>Q.value.some(u=>{let{label:y}=u;return!!y})),oe={activeThumbRef:F,color:E(t,"color"),decimals:q,disabled:H,direction:E(t,"direction"),elevation:E(t,"elevation"),hasLabels:re,isReversed:c,indexFromEnd:P,min:k,max:p,mousePressed:S,numTicks:$,onSliderMousedown:V,onSliderTouchstart:me,parsedTicks:Q,parseMouseMove:f,position:g,readonly:E(t,"readonly"),rounded:E(t,"rounded"),roundValue:A,showTicks:J,startOffset:C,step:L,thumbSize:x,thumbColor:O,thumbLabel:E(t,"thumbLabel"),ticks:E(t,"ticks"),tickSize:G,trackColor:b,trackContainerRef:R,trackFillColor:N,trackSize:j,vertical:h};return Qe(ye,oe),oe},Wt=ae({focused:Boolean,max:{type:Number,required:!0},min:{type:Number,required:!0},modelValue:{type:Number,required:!0},position:{type:Number,required:!0},ripple:{type:[Boolean,Object],default:!0},...fe()},"VSliderThumb"),Xt=ue()({name:"VSliderThumb",directives:{Ripple:et},props:Wt(),emits:{"update:modelValue":e=>!0},setup(e,t){let{slots:a,emit:o}=t;const i=Ee(ye),{isRtl:l,rtlClasses:n}=pe();if(!i)throw new Error("[Vuetify] v-slider-thumb must be used inside v-slider or v-range-slider");const{thumbColor:r,step:c,disabled:h,thumbSize:P,thumbLabel:k,direction:p,isReversed:L,vertical:q,readonly:A,elevation:x,mousePressed:G,decimals:j,indexFromEnd:$}=i,H=v(()=>h.value?void 0:x.value),{elevationClasses:O}=tt(H),{textColorClasses:b,textColorStyles:N}=at(r),{pageup:S,pagedown:C,end:R,home:F,left:f,right:z,down:K,up:I}=ot,Z=[S,C,R,F,f,z,K,I],le=v(()=>c.value?[1,2,3]:[1,5,10]);function se(V,g){if(!Z.includes(V.key))return;V.preventDefault();const J=c.value||.1,Q=(e.max-e.min)/J;if([f,z,K,I].includes(V.key)){const oe=(q.value?[l.value?f:z,L.value?K:I]:$.value!==l.value?[f,I]:[z,I]).includes(V.key)?1:-1,u=V.shiftKey?2:V.ctrlKey?1:0;g=g+oe*J*le.value[u]}else if(V.key===F)g=e.min;else if(V.key===R)g=e.max;else{const re=V.key===C?1:-1;g=g-re*J*(Q>100?Q/10:10)}return Math.max(e.min,Math.min(e.max,g))}function me(V){const g=se(V,e.modelValue);g!=null&&o("update:modelValue",g)}return de(()=>{const V=W($.value?100-e.position:e.position,"%");return s("div",{class:["v-slider-thumb",{"v-slider-thumb--focused":e.focused,"v-slider-thumb--pressed":e.focused&&G.value},e.class,n.value],style:[{"--v-slider-thumb-position":V,"--v-slider-thumb-size":W(P.value)},e.style],role:"slider",tabindex:h.value?-1:0,"aria-valuemin":e.min,"aria-valuemax":e.max,"aria-valuenow":e.modelValue,"aria-readonly":!!A.value,"aria-orientation":p.value,onKeydown:A.value?void 0:me},[s("div",{class:["v-slider-thumb__surface",b.value,O.value],style:{...N.value}},null),Te(s("div",{class:["v-slider-thumb__ripple",b.value],style:N.value},null),[[lt("ripple"),e.ripple,null,{circle:!0,center:!0}]]),s(st,{origin:"bottom center"},{default:()=>{var g;return[Te(s("div",{class:"v-slider-thumb__label-container"},[s("div",{class:["v-slider-thumb__label"]},[s("div",null,[((g=a["thumb-label"])==null?void 0:g.call(a,{modelValue:e.modelValue}))??e.modelValue.toFixed(c.value?j.value:1)])])]),[[rt,k.value&&e.focused||k.value==="always"]])]}})])}),{}}}),Zt=ae({start:{type:Number,required:!0},stop:{type:Number,required:!0},...fe()},"VSliderTrack"),Jt=ue()({name:"VSliderTrack",props:Zt(),emits:{},setup(e,t){let{slots:a}=t;const o=Ee(ye);if(!o)throw new Error("[Vuetify] v-slider-track must be inside v-slider or v-range-slider");const{color:i,parsedTicks:l,rounded:n,showTicks:r,tickSize:c,trackColor:h,trackFillColor:P,trackSize:k,vertical:p,min:L,max:q,indexFromEnd:A}=o,{roundedClasses:x}=it(n),{backgroundColorClasses:G,backgroundColorStyles:j}=we(P),{backgroundColorClasses:$,backgroundColorStyles:H}=we(h),O=v(()=>`inset-${p.value?"block":"inline"}-${A.value?"end":"start"}`),b=v(()=>p.value?"height":"width"),N=v(()=>({[O.value]:"0%",[b.value]:"100%"})),S=v(()=>e.stop-e.start),C=v(()=>({[O.value]:W(e.start,"%"),[b.value]:W(S.value,"%")})),R=v(()=>r.value?(p.value?l.value.slice().reverse():l.value).map((f,z)=>{var I;const K=f.value!==L.value&&f.value!==q.value?W(f.position,"%"):void 0;return s("div",{key:f.value,class:["v-slider-track__tick",{"v-slider-track__tick--filled":f.position>=e.start&&f.position<=e.stop,"v-slider-track__tick--first":f.value===L.value,"v-slider-track__tick--last":f.value===q.value}],style:{[O.value]:K}},[(f.label||a["tick-label"])&&s("div",{class:"v-slider-track__tick-label"},[((I=a["tick-label"])==null?void 0:I.call(a,{tick:f,index:z}))??f.label])])}):[]);return de(()=>s("div",{class:["v-slider-track",x.value,e.class],style:[{"--v-slider-track-size":W(k.value),"--v-slider-tick-size":W(c.value)},e.style]},[s("div",{class:["v-slider-track__background",$.value,{"v-slider-track__background--opacity":!!i.value||!P.value}],style:{...N.value,...H.value}},null),s("div",{class:["v-slider-track__fill",G.value],style:{...C.value,...j.value}},null),r.value&&s("div",{class:["v-slider-track__ticks",{"v-slider-track__ticks--always-show":r.value==="always"}]},[R.value])])),{}}}),Qt=ae({...Nt(),...Yt(),...Rt(),modelValue:{type:[Number,String],default:0}},"VSlider"),ea=ue()({name:"VSlider",props:Qt(),emits:{"update:focused":e=>!0,"update:modelValue":e=>!0,start:e=>!0,end:e=>!0},setup(e,t){let{slots:a,emit:o}=t;const i=he(),{rtlClasses:l}=pe(),n=xt(e),r=nt(e,"modelValue",void 0,b=>n.roundValue(b??n.min.value)),{min:c,max:h,mousePressed:P,roundValue:k,onSliderMousedown:p,onSliderTouchstart:L,trackContainerRef:q,position:A,hasLabels:x,readonly:G}=Ht({props:e,steps:n,onSliderStart:()=>{o("start",r.value)},onSliderEnd:b=>{let{value:N}=b;const S=k(N);r.value=S,o("end",S)},onSliderMove:b=>{let{value:N}=b;return r.value=k(N)},getActiveThumb:()=>{var b;return(b=i.value)==null?void 0:b.$el}}),{isFocused:j,focus:$,blur:H}=Ft(e),O=v(()=>A(r.value));return de(()=>{const b=Be.filterProps(e),N=!!(e.label||a.label||a.prepend);return s(Be,X({class:["v-slider",{"v-slider--has-labels":!!a["tick-label"]||x.value,"v-slider--focused":j.value,"v-slider--pressed":P.value,"v-slider--disabled":e.disabled},l.value,e.class],style:e.style},b,{focused:j.value}),{...a,prepend:N?S=>{var C,R;return s(be,null,[((C=a.label)==null?void 0:C.call(a,S))??(e.label?s(Et,{id:S.id.value,class:"v-slider__label",text:e.label},null):void 0),(R=a.prepend)==null?void 0:R.call(a,S)])}:void 0,default:S=>{let{id:C,messagesId:R}=S;return s("div",{class:"v-slider__container",onMousedown:G.value?void 0:p,onTouchstartPassive:G.value?void 0:L},[s("input",{id:C.value,name:e.name||C.value,disabled:!!e.disabled,readonly:!!e.readonly,tabindex:"-1",value:r.value},null),s(Jt,{ref:q,start:0,stop:O.value},{"tick-label":a["tick-label"]}),s(Xt,{ref:i,"aria-describedby":R.value,focused:j.value,min:c.value,max:h.value,modelValue:r.value,"onUpdate:modelValue":F=>r.value=F,position:O.value,elevation:e.elevation,onFocus:$,onBlur:H,ripple:e.ripple},{"thumb-label":a["thumb-label"]})])}})}),{}}}),ta={name:"PaginationSlider",props:{min:{type:Number,default:0}}};function aa(e,t,a,o,i,l){return d(),B(ea,X({"thumb-size":"36",class:"paginationSlider",density:"compact","hide-details":"auto",min:a.min,rounded:!0,"show-ticks":"always",step:1,"thumb-label":"always"},e.$attrs),{"tick-label":_(({index:n})=>[D(T(n+a.min),1)]),_:1},16,["min"])}const wl=U(ta,[["render",aa],["__scopeId","data-v-01b67afd"]]),la={name:"PaginationNavButton"};function sa(e,t,a,o,i,l){return d(),B(ie,X({class:"paginationNavButton",height:"100%"},e.$attrs),Ne({_:2},[ce(e.$slots,(n,r)=>({name:r,fn:_(c=>[Re(e.$slots,r,X({props:n},c),void 0,!0)])}))]),1040)}const Vl=U(la,[["render",sa],["__scopeId","data-v-852fad11"]]),Pe=Dt.browser.vuetifyNullCode,ra=new Set(["",Pe,Pe.toString(),void 0]),oa=function(e){let t;return e===void 0?t=e:e instanceof Object?t={value:e.pk,title:e.name}:t={value:e,title:e.toString()},e.url&&(t.url=e.url),t},ia=function(e,t){return e.title<t.title?-1:e.title>t.title?1:0},na=function(e,t){return Number.parseFloat(e.title)-Number.parseFloat(t.title)},ua=function(e,t,a=!1){const o=e||[],i=t&&t.toLowerCase();let l=[];for(const r of o){if(!r||ra.has(r.pk))continue;const c=oa(r);c&&(!i||c.title&&c.title.toLowerCase().includes(i))&&l.push(c)}const n=a?na:ia;return l.sort(n)},da={name:"PlaceholderLoading",props:{indeterminate:{type:Boolean,default:!0}}};function ca(e,t,a,o,i,l){return d(),B(ut,X({"aria-label":"loading",class:"codexProgressCircular",indeterminate:a.indeterminate},e.$attrs),null,16,["indeterminate"])}const Oe=U(da,[["render",ca],["__scopeId","data-v-7bb4cf22"]]),ma=["B","kB","MB","GB","TB","PB","EB","ZB","YB"],va=["B","KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"],ha=["b","kbit","Mbit","Gbit","Tbit","Pbit","Ebit","Zbit","Ybit"],fa=["b","kibit","Mibit","Gibit","Tibit","Pibit","Eibit","Zibit","Yibit"],Ie=(e,t,a)=>{let o=e;return typeof t=="string"||Array.isArray(t)?o=e.toLocaleString(t,a):(t===!0||a!==void 0)&&(o=e.toLocaleString(void 0,a)),o};function pa(e,t){if(!Number.isFinite(e))throw new TypeError(`Expected a finite number, got ${typeof e}: ${e}`);t={bits:!1,binary:!1,space:!0,...t};const a=t.bits?t.binary?fa:ha:t.binary?va:ma,o=t.space?" ":"";if(t.signed&&e===0)return` 0${o}${a[0]}`;const i=e<0,l=i?"-":t.signed?"+":"";i&&(e=-e);let n;if(t.minimumFractionDigits!==void 0&&(n={minimumFractionDigits:t.minimumFractionDigits}),t.maximumFractionDigits!==void 0&&(n={maximumFractionDigits:t.maximumFractionDigits,...n}),e<1){const P=Ie(e,t.locale,n);return l+P+o+a[0]}const r=Math.min(Math.floor(t.binary?Math.log(e)/Math.log(1024):Math.log10(e)/3),a.length-1);e/=(t.binary?1024:1e3)**r,n||(e=e.toPrecision(3));const c=Ie(Number(e),t.locale,n),h=a[r];return l+c+o+h}const ba=(e,t)=>e?`${dt(e)}/cover.webp?${t}`:window.CODEX.MISSING_COVER,ga={name:"BookCover",props:{group:{type:String,required:!0},childCount:{type:Number,default:1},finished:{type:Boolean},coverPk:{type:Number,required:!0}},data(){return{showPlaceholder:!1}},computed:{...ee(Y,{coverSrc:function(e){return ba(this.coverPk,e.page.coversTimestamp)}})},mounted:function(){this.delayPlaceholder()},methods:{delayPlaceholder:function(){setTimeout(()=>{this.showPlaceholder=!0},2e3)}}},ya={class:"bookCover"},ka={key:1,class:"childCount"};function _a(e,t,a,o,i,l){return d(),w("div",ya,[s(ct,{src:e.coverSrc,class:"coverImg"},null,8,["src"]),a.finished!==!0?(d(),w("div",{key:0,class:ge({unreadFlag:!0,mixedreadFlag:a.finished===null})},null,2)):M("",!0),a.group!=="c"?(d(),w("span",ka,T(a.childCount),1)):M("",!0)])}const Ae=U(ga,[["render",_a],["__scopeId","data-v-9acb5f6a"]]),Sa={name:"MetadataTags",props:{label:{type:String,required:!0},values:{type:Array,default(){return[]}},filter:{type:String,required:!1,default:void 0}},data(){return{mdiFilter:mt,mdiOpenInNew:De}},computed:{...ee(Y,{filterValues(e){const t=this.filter||this.label.toLowerCase();return e.settings.filters[t]},topGroup:e=>e.settings.topGroup}),model(){return ua(this.values)},chipClass(e){return{browseChip:this.filter&&e}}},methods:{...ne(Y,["setSettings"]),chipColor(e){return this.filterValues&&this.filterValues.includes(e)?this.$vuetify.theme.current.colors["primary-darken-1"]:""},onClick(e){if(!this.filter||!e)return;const t=["f","s"].includes(this.topGroup)?this.topGroup:"r",a=t==="s"&&this.filter==="storyArcs";if(!a){const n={filters:{[this.filter]:[e]}};this.setSettings(n)}const l={name:"browser",params:{group:t,pk:a?e:0,page:1}};this.$router.push(l)}}},Ca={key:0,class:"tags"},Ta={class:"chipGroupLabel"},wa=["href"];function Va(e,t,a,o,i,l){return l.model&&l.model.length>0?(d(),w("div",Ca,[m("div",Ta,T(a.label),1),s(Ot,{column:!0,multiple:"",value:l.model},{default:_(()=>[(d(!0),w(be,null,ce(l.model,n=>(d(),B($t,{key:`${a.label}/${n.value}`,color:l.chipColor(n.value),value:n.value,onClick:r=>l.onClick(n.value)},{default:_(()=>[n.url?(d(),w("a",{key:0,href:n.url,target:"_blank"},[D(T(n.title),1),s(te,null,{default:_(()=>[D(T(i.mdiOpenInNew),1)]),_:1})],8,wa)):(d(),w("span",{key:1,class:ge(l.chipClass)},T(n.title),3))]),_:2},1032,["color","value","onClick"]))),128))]),_:1},8,["value"])])):M("",!0)}const ke=U(Sa,[["render",Va],["__scopeId","data-v-ea0e4633"]]),Ba={name:"MetadataTextBox",props:{label:{type:String,required:!0},value:{type:[Object,String,Number,Boolean],default:void 0},link:{type:[Boolean,String],default:!1},group:{type:String,default:""},obj:{type:Object,default:void 0}},data(){return{mdiOpenInNew:De}},computed:{computedValue(){return this.value!=null&&this.value instanceof Object?this.value.name:this.value},linkValue(){return this.link===!0?this.computedValue:this.link?this.link:!1},highlight(){var e;return((e=this.obj)==null?void 0:e.group)===this.group},pathArray(){if(this.computedValue)return this.computedValue.split("/")},folderPath(){if(this.pathArray)return this.pathArray.slice(0,-1).join("/")},basePath(){if(this.pathArray)return this.pathArray.at(-1)},groupTo(){var o;const e=Y();if(this.group!=="f"&&!e.settings.show[this.group]||this.group==="f"&&!e.page.adminFlags.folderView)return;const t=((o=this.obj)==null?void 0:o.group)==this.group?this.obj.pk:this.value.pk;if(!t)return;const a=this.$router.currentRoute.value.params;if(!(a.group===this.group&&+a.pk===t))return{name:"browser",params:{group:this.group,pk:t}}}}},Pa={class:"textLabel"},Ia={class:"textValue"},Ma=["href"],Na={key:3,class:"textContent"},Ra={key:4,id:"basePath"};function Fa(e,t,a,o,i,l){const n=Le("router-link");return l.computedValue?(d(),w("div",{key:0,class:ge(["text",{highlight:l.highlight}])},[m("div",Pa,T(a.label),1),m("div",Ia,[l.groupTo&&a.group==="f"?(d(),B(n,{key:0,id:"folderPath",to:l.groupTo,title:"Browse Folder"},{default:_(()=>[D(T(l.folderPath)+"/ ",1)]),_:1},8,["to"])):l.groupTo?(d(),B(n,{key:1,class:"textContent",to:l.groupTo,title:`Browse ${a.label}`},{default:_(()=>[D(T(l.computedValue),1)]),_:1},8,["to","title"])):a.link?(d(),w("a",{key:2,href:l.linkValue,target:"_blank"},[D(T(l.computedValue)+" ",1),s(te,{size:"small"},{default:_(()=>[D(T(i.mdiOpenInNew),1)]),_:1})],8,Ma)):(d(),w("div",Na,T(l.computedValue),1)),l.groupTo&&a.group==="f"?(d(),w("span",Ra,T(l.basePath),1)):M("",!0)])],2)):M("",!0)}const je=U(Ba,[["render",Fa],["__scopeId","data-v-0117c753"]]),Ea={name:"MetadataContributorsTable",props:{value:{type:Array,default:void 0}},data(){return{}},computed:{contributorsDict(){const e={};for(const{role:o,person:i}of this.value){const l=At(o.name)+"s";e[l]||(e[l]=[]),e[l].push(i)}const t=Object.keys(e).sort((o,i)=>o.localeCompare(i)),a={};for(const o of t)a[o]=e[o].sort((i,l)=>i.name.localeCompare(l.name));return a}}},Da={key:0},La=m("h3",null,"Contributors",-1);function $a(e,t,a,o,i,l){const n=ke;return Object.keys(l.contributorsDict).length>0?(d(),w("div",Da,[La,(d(!0),w(be,null,ce(Object.entries(l.contributorsDict),([r,c])=>(d(),B(n,{key:r,values:c,label:r,filter:"contributors"},null,8,["values","label"]))),128))])):M("",!0)}const Oa=U(Ea,[["render",$a]]),ze=new Set("rtl","btt");Object.freeze(ze);const Aa=({pk:e,page:t,readingDirection:a,pageCount:o},i)=>{if(!(i&&!o)){if(t)t=Number(t);else if(ze.has(a)){const l=Number(o)-1;t=Math.max(l,0)}else t=0;return{name:"reader",params:{pk:e,page:t}}}},Me=vt("metadata",{state:()=>({md:void 0}),actions:{async loadMetadata({group:e,pk:t}){const a=Y();await Lt.getMetadata({group:e,pk:t},a.settings).then(o=>(this.md=o.data,!0)).catch(o=>{console.error(o),this.clearMetadata()})},clearMetadata(){this.md=void 0}}}),ja=1160,za=.05,Ua=250,qa={name:"MetadataButton",components:{BookCover:Ae,CloseButton:$e,MetadataContributorsTable:Oa,MetadataTags:ke,MetadataText:je,PlaceholderLoading:Oe},props:{group:{type:String,required:!0},book:{type:Object,required:!0},children:{type:Number,default:1}},data(){return{mdiDownload:ht,mdiTagOutline:ft,dialog:!1,progress:0}},computed:{...pt(bt,["isUserAdmin"]),...ee(Y,{twentyFourHourTime:e=>e.settings.twentyFourHourTime,readingDirectionTitles:e=>e.choices.static.readingDirection,identifierTypes:e=>e.choices.static.identifierType,importMetadata:e=>e.page.adminFlags.importMetadata}),...ee(Me,{md:e=>e.md,downloadFileName:e=>{var a;const t=e.md;return(a=e.md)!=null&&a.path?t.path.split("/").at(-1):Pt({seriesName:t.series.name,volumeName:t.volume.name,issueNumber:t.issueNumber,issueSuffix:t.issueSuffix})+"."+(void 0).fileType.toLowerCase()}}),...ee(Y,{q:e=>e.settings.q}),downloadURL(){return It(this.book)},isReadButtonShown(){return this.group==="c"&&this.$route.name!="reader"},isReadButtonEnabled(){return this.$route.name==="browser"&&!!this.readerRoute},readButtonIcon(){return this.isReadButtonEnabled?gt:yt},readerRoute(){return Aa(this.md,this.importMetadata)},formattedIssue(){if(!((this.md.issueNumber===null||this.md.issueNumber===void 0)&&!this.md.issueSuffix))return Mt(this.md)},readingDirectionText(){return this.readingDirectionTitles[this.md.readingDirection]},pages(){let e="";if(this.md.page){const a=Ve.format(this.md.page);e+=`Read ${a} of `}const t=Ve.format(this.md.pageCount);return e+=`${t} pages`,this.md.progress>0&&(e+=` (${Math.round(this.md.progress)}%)`),e},size(){return this.md.size>0?pa(this.md.size):0},fileType(){return this.md.fileType||"Unknown"},titledIdentifiers(){if(!this.md.identifiers)return this.md.identifiers;const e=[];for(const t of this.md.identifiers){const a=t.name.split(":"),o=a[0],i=a[1],l=this.identifierTypeTitle(o);let n="";l&&l!=="None"&&(n+=l+":"),n+=i,e.push({...t,name:n})}return e}},watch:{dialog(e){e?this.dialogOpened():this.clearMetadata()}},methods:{...ne(Me,["clearMetadata","loadMetadata"]),...ne(kt,["downloadIOSPWAFix"]),...ne(Y,["identifierTypeTitle"]),dialogOpened(){this.loadMetadata({group:this.group,pk:this.book.pk}),this.startProgress()},startProgress(){this.startTime=Date.now(),this.estimatedMS=Math.max(za,this.children/ja)*1e3,this.updateProgress()},updateProgress(){const e=Date.now()-this.startTime;this.progress=e/this.estimatedMS*100,!(this.progress>=100||this.md)&&setTimeout(()=>{this.updateProgress()},Ua)},formatDateTime(e){return _t(e,this.twentyFourHourTime)},download(){this.downloadIOSPWAFix(this.downloadURL,this.md.filename)}}},Ga=e=>(wt("data-v-bf55d004"),e=e(),Vt(),e),Ka={id:"metadataHeader"},Ya={id:"metadataBookCoverWrapper"},xa={class:"inlineRow"},Ha={class:"inlineRow"},Wa={class:"inlineRow"},Xa={key:1,class:"inlineRow"},Za={id:"metadataBody"},Ja={class:"mdSection"},Qa={class:"quintRow"},el={class:"mdSection"},tl={class:"quarterRow"},al={class:"lastSmallRow"},ll={class:"halfRow mdSection"},sl={class:"mdSection"},rl={class:"mdSection"},ol={class:"mdSection"},il={class:"mdSection"},nl={class:"mdSection"},ul={class:"mdSection inlineRow"},dl={class:"inlineRow"},cl={id:"footerLinks"},ml={id:"bottomRightButtons"},vl={key:1,id:"placeholderContainer"},hl=Ga(()=>m("div",{id:"placeholderTitle"},"Tags Loading",-1));function fl(e,t,a,o,i,l){const n=$e,r=je,c=Ae,h=ke,P=Le("MetadataContributorsTable"),k=Oe;return d(),B(jt,{modelValue:i.dialog,"onUpdate:modelValue":t[5]||(t[5]=p=>i.dialog=p),fullscreen:"",transition:"dialog-bottom-transition"},{activator:_(({props:p})=>[s(ie,X({"aria-label":"tags",class:"tagButton cardControlButton",icon:"",title:"Tags",variant:"text"},p,{onClick:t[0]||(t[0]=St(()=>{},["prevent"]))}),{default:_(()=>[s(te,null,{default:_(()=>[D(T(i.mdiTagOutline),1)]),_:1})]),_:2},1040)]),default:_(()=>[e.md?(d(),w("div",{key:0,id:"metadataContainer",onKeyup:t[3]||(t[3]=Tt(p=>i.dialog=!1,["esc"]))},[m("header",Ka,[s(n,{class:"closeButton",title:"Close Metadata (esc)",size:"x-large",onClick:t[1]||(t[1]=p=>i.dialog=!1)}),e.q?(d(),B(r,{key:0,id:"search",value:e.q,label:"Search Query",highlight:!0},null,8,["value"])):M("",!0),m("div",Ya,[s(c,{id:"bookCover","cover-pk":e.md.coverPk,group:a.group,"child-count":e.md.childCount,finished:e.md.finished},null,8,["cover-pk","group","child-count","finished"]),s(Ct,{class:"bookCoverProgress","model-value":e.md.progress,rounded:"","background-color":"inherit",height:"2","aria-label":"% read"},null,8,["model-value"])]),m("div",xa,[s(r,{id:"publisher",value:e.md.publisher,group:"p",label:"Publisher",obj:{pk:e.md.id,group:e.md.group}},null,8,["value","obj"]),s(r,{id:"imprint",value:e.md.imprint,group:"i",label:"Imprint",obj:{pk:e.md.id,group:e.md.group}},null,8,["value","obj"])]),m("div",Ha,[s(r,{id:"series",value:e.md.series,label:"Series",group:"s",obj:{pk:e.md.id,group:e.md.group}},null,8,["value","obj"])]),m("div",Wa,[s(r,{id:"volume",value:e.md.volume,label:"Volume",group:"v",obj:{pk:e.md.id,group:e.md.group}},null,8,["value","obj"]),s(r,{value:e.md.seriesVolumeCount,label:"Volume Count"},null,8,["value"]),s(r,{id:"issue",value:l.formattedIssue,label:"Issue",group:"c",obj:{pk:e.md.id,group:e.md.group}},null,8,["value","obj"]),s(r,{value:e.md.volumeIssueCount,label:"Issue Count"},null,8,["value"]),s(r,{value:e.md.name,label:"Title"},null,8,["value"])]),e.md.year||e.md.month||e.md.day?(d(),w("div",Xa,[s(r,{value:e.md.year,label:"Year",class:"datePicker",type:"number"},null,8,["value"]),s(r,{value:e.md.month,label:"Month",class:"datePicker"},null,8,["value"]),s(r,{value:e.md.day,label:"Day",class:"datePicker"},null,8,["value"])])):M("",!0)]),m("div",Za,[m("section",Ja,[m("div",Qa,[s(r,{value:l.pages,label:"Pages"},null,8,["value"]),s(r,{label:"Finished",value:(!!e.md.finished).toString()},null,8,["value"]),s(r,{label:"Reading Direction",value:l.readingDirectionText},null,8,["value"]),s(r,{value:(!!e.md.monochrome).toString(),label:"Monochrome"},null,8,["value"]),s(r,{value:e.md.original_format,label:"Original Format"},null,8,["value"])])]),m("section",el,[m("div",tl,[e.md.createdAt?(d(),B(r,{key:0,value:l.formatDateTime(e.md.createdAt),label:"Created at",class:"mtime"},null,8,["value"])):M("",!0),e.md.updatedAt?(d(),B(r,{key:1,value:l.formatDateTime(e.md.updatedAt),label:"Updated at",class:"mtime"},null,8,["value"])):M("",!0),s(r,{value:l.size,label:"Size"},null,8,["value"]),s(r,{value:l.fileType,label:"File Type"},null,8,["value"])]),m("div",al,[s(r,{group:"f",value:{pk:e.md.parentFolderId,name:e.md.path},label:"Path"},null,8,["value"])])]),m("section",ll,[s(r,{value:e.md.country,label:"Country"},null,8,["value"]),s(r,{value:e.md.language,label:"Language"},null,8,["value"])]),m("section",sl,[s(h,{values:l.titledIdentifiers,label:"Identifiers"},null,8,["values"])]),m("section",rl,[s(r,{value:e.md.summary,label:"Summary"},null,8,["value"]),s(r,{value:e.md.review,label:"Review"},null,8,["value"])]),m("section",ol,[s(r,{value:e.md.communityRating,label:"Community Rating"},null,8,["value"]),s(r,{value:e.md.criticalRating,label:"Critical Rating"},null,8,["value"]),s(r,{value:e.md.ageRating,label:"Age Rating"},null,8,["value"])]),m("section",il,[s(h,{values:e.md.genres,label:"Genres",filter:"genres"},null,8,["values"]),s(h,{values:e.md.characters,label:"Characters",filter:"characters"},null,8,["values"]),s(h,{values:e.md.teams,label:"Teams",filter:"teams"},null,8,["values"]),s(h,{values:e.md.locations,label:"Locations",filter:"locations"},null,8,["values"]),s(h,{values:e.md.seriesGroups,label:"Series Groups",filter:"seriesGroups"},null,8,["values"]),s(h,{values:e.md.stories,label:"Stories",filter:"stories"},null,8,["values"]),s(h,{values:e.md.storyArcNumbers,label:"Story Arcs",filter:"storyArcs"},null,8,["values"]),s(h,{values:e.md.tags,label:"Tags",filter:"tags"},null,8,["values"])]),m("section",nl,[s(P,{value:e.md.contributors},null,8,["value"])]),m("section",ul,[s(r,{value:e.md.notes,label:"Notes"},null,8,["value"])]),m("section",dl,[s(r,{value:e.md.tagger,label:"Tagger"},null,8,["value"]),s(r,{value:e.md.scanInfo,label:"Scan"},null,8,["value"])])]),m("footer",cl,[a.group==="c"?(d(),B(ie,{key:0,id:"downloadButton",title:"Download Comic Archive",onClick:l.download},{default:_(()=>[a.group==="c"?(d(),B(te,{key:0},{default:_(()=>[D(T(i.mdiDownload),1)]),_:1})):M("",!0),D(" Download ")]),_:1},8,["onClick"])):M("",!0),l.isReadButtonShown?(d(),B(ie,{key:1,to:l.readerRoute,title:"Read Comic",disabled:!l.isReadButtonEnabled},{default:_(()=>[s(te,null,{default:_(()=>[D(T(l.readButtonIcon),1)]),_:1}),D(" Read ")]),_:1},8,["to","disabled"])):M("",!0),m("span",ml,[s(n,{class:"closeButton",title:"Close Metadata (esc)",size:"x-large",onClick:t[2]||(t[2]=p=>i.dialog=!1)})])])],32)):(d(),w("div",vl,[s(n,{class:"closeButton",title:"Close Metadata (esc)",onClick:t[4]||(t[4]=p=>i.dialog=!1)}),hl,s(k,{"model-value":i.progress,indeterminate:i.progress>=100,class:"placeholder"},null,8,["model-value","indeterminate"])]))]),_:1},8,["modelValue"])}const Bl=U(qa,[["render",fl],["__scopeId","data-v-bf55d004"]]);export{ra as N,Oe as P,Cl as V,Vl as _,wl as a,Tl as b,Bl as c,Ae as d,Aa as g,pa as p,ua as t};
