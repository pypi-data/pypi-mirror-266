(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[877],{4768:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/app/settings",function(){return n(1861)}])},4626:function(e,t,n){"use strict";n.d(t,{Z:function(){return Z}});var i=n(5893),s=n(7294),o=n(1163),a=n(9008),r=n.n(a),l=n(3946),c=n(8849),d=n(5317),h=n(8298),u=n(2734),p=n(2293),x=n(5582),g=n(155),m=n(6886),y=n(9417),j=n(5861),k=n(5616);function v(e){let{children:t}=e,n=(0,h.Z)({disableHysteresis:!0,threshold:24});return(0,s.cloneElement)(t,{elevation:n?4:0})}var b=function(){let e=(0,u.Z)();return(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(v,{children:(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(p.Z,{color:"transparent",elevation:0,children:(0,i.jsx)(x.Z,{maxWidth:"xl",sx:{padding:0},children:(0,i.jsx)(g.Z,{sx:{minHeight:50,maxHeight:50,padding:0,flex:1,alignItems:"center",justifyContent:"space-between",display:"flex",flexWrap:"nowrap"},children:(0,i.jsx)(m.ZP,{item:!0,children:(0,i.jsx)(y.Z,{href:"https://system-bridge.timmo.dev",target:"_blank",children:(0,i.jsx)(j.Z,{component:"div",variant:"h4",sx:{textTransform:"none",userSelect:"none",color:e.palette.primary.contrastText},children:"System Bridge"})})})})})}),(0,i.jsx)(k.Z,{sx:{height:e.spacing(10)}})]})})})};let f=!1;var Z=function(e){let t=(0,o.useRouter)();return(0,s.useEffect)(()=>{if(t.isReady&&!f){var e,n,i,s;f=!0;let o=(null===(e=t.query)||void 0===e?void 0:e.token)||"",a=(null===(n=t.query)||void 0===n?void 0:n.apiPort)||"9170",r=!1;if((null===(i=t.query)||void 0===i?void 0:i.token)||(r=!0,o=window.prompt("Please enter your Token",o)),(null===(s=t.query)||void 0===s?void 0:s.apiPort)||(r=!0,a=window.prompt("Please enter your API port (default: 9170)",a)),r&&o&&a){let e=t.asPath.split("?")[0];t.replace({pathname:e.includes(".html")?e:"".concat(e,".html"),query:{...t.query,token:o,apiPort:a}})}}},[t]),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(r(),{children:[(0,i.jsx)("title",{children:e.title?"".concat(e.title," - System Bridge"):"System Bridge"}),(0,i.jsx)("link",{rel:"canonical",href:e.url}),(0,i.jsx)("meta",{name:"description",content:e.description?"".concat(e.description):e.title?"".concat(e.title," - System Bridge"):"System Bridge"}),(0,i.jsx)("meta",{name:"keywords",content:e.keywords?"".concat(e.keywords):"system-bridge, system, bridge, typescript"})]}),!e.noHeader&&(0,i.jsx)(b,{}),e.closeButton&&(0,i.jsx)(l.Z,{size:"small",sx:{position:"absolute",top:4,right:4,zIndex:1e3},onClick:()=>{window.location.href="http://close.window"},children:(0,i.jsx)(c.Icon,{id:"close",path:d.r5M,size:1})}),e.children]})}},8433:function(e,t,n){"use strict";n.d(t,{D:function(){return o},X:function(){return s}});var i=n(7294);function s(e){navigator.permissions.query({name:"clipboard-write"}).then(t=>{("granted"===t.state||"prompt"===t.state)&&navigator.clipboard.writeText(e)})}function o(e){let t=(0,i.useRef)();return(0,i.useEffect)(()=>{t.current=e}),t.current}},8833:function(e,t,n){"use strict";n.d(t,{C:function(){return s}});var i=n(7632);class s{close(){this.websocket&&this.websocket.readyState===this.websocket.OPEN&&this.websocket.close()}async connect(){let e=new WebSocket("ws://".concat(window.location.hostname||"localhost",":").concat(this.port,"/api/websocket"));return await new Promise(t=>{e.onopen=()=>t()}),e.onmessage=e=>{if("string"==typeof e.data){let t=JSON.parse(e.data);t&&this.onEvent&&this.onEvent(t)}},e}isConnected(){var e;return(null===(e=this.websocket)||void 0===e?void 0:e.readyState)===WebSocket.OPEN}getData(e){this.websocket&&this.websocket.readyState===this.websocket.OPEN&&(console.log("Get data:",e),this.websocket.send(JSON.stringify({id:(0,i.Z)(),token:this.token,event:"GET_DATA",data:{modules:e}})))}getSettings(){this.websocket&&this.websocket.readyState===this.websocket.OPEN&&(console.log("Get settings"),this.websocket.send(JSON.stringify({id:(0,i.Z)(),token:this.token,event:"GET_SETTINGS",data:{}})))}registerDataListener(e){this.websocket&&this.websocket.readyState===this.websocket.OPEN&&(console.log("Register data listener:",e),this.websocket.send(JSON.stringify({id:(0,i.Z)(),token:this.token,event:"REGISTER_DATA_LISTENER",data:{modules:e}})))}sendPlayerStatus(e){this.websocket&&this.websocket.readyState===this.websocket.OPEN&&this.websocket.send(JSON.stringify({id:(0,i.Z)(),token:this.token,event:"MEDIA_STATUS",data:{status:e}}))}updateSettings(e){this.websocket&&this.websocket.readyState===this.websocket.OPEN&&(console.log("Update setting:",e),this.websocket.send(JSON.stringify({id:(0,i.Z)(),token:this.token,event:"UPDATE_SETTINGS",data:e})))}constructor(e,t,n){this.port=e||9170,this.token=t,(async()=>{this.websocket=await this.connect(),n&&this.websocket&&this.websocket.readyState===this.websocket.OPEN&&n()})()}}},1861:function(e,t,n){"use strict";let i;n.r(t),n.d(t,{default:function(){return V}});var s=n(5893),o=n(7294),a=n(5582),r=n(4626),l=n(2734),c=n(6886),d=n(8456),h=n(1163),u=n(5317),p=n(5069),x=n(8833),g=n(5861),m=n(629),y=n(8462),j=function(e){let{name:t,description:n,children:i}=e;return(0,s.jsxs)(c.ZP,{container:!0,direction:"row",item:!0,xs:12,children:[(0,s.jsxs)(c.ZP,{item:!0,xs:4,style:{userSelect:"none"},children:[(0,s.jsx)(g.Z,{component:"h3",variant:"h5",children:t}),(0,s.jsx)(g.Z,{variant:"subtitle1",children:n})]}),(0,s.jsx)(c.ZP,{item:!0,xs:8,children:(0,s.jsx)(m.Z,{children:(0,s.jsx)(y.Z,{children:i})})})]})},k=n(7632),v=n(8619),b=n(9294),f=n(796),Z=n(9953),w=n(3395),S=n(9653),P=n(4054),I=n(7709),C=n(7109),_=n(3946),E=n(8373),N=n(699),A=n(8849),T=n(8433),O=n(1730),R=n(657),W=n(7645),z=n(8951),D=n(6514),G=n(1425),L=n(9417),q=n(6486),F=n.n(q);let B={additional_media_directories:{name:"Name",value:"Path"},keyboard_hotkeys:{name:"Hotkey",value:"Action"}};var U=function(e){let{id:t,setting:n,listIn:i,open:a,setOpen:r,handleChanged:d}=e,[h,p]=(0,o.useState)([]),{name:x,description:g,icon:m}=n;(0,o.useEffect)(()=>{!a&&i&&p(i)},[i,a]);let j=(0,l.Z)(),k=(0,O.Z)(j.breakpoints.down("md"));return(0,s.jsxs)(R.Z,{fullScreen:k,fullWidth:!0,maxWidth:"lg",open:a,scroll:"paper",PaperProps:{style:{background:j.palette.background.paper}},children:[(0,s.jsxs)(W.Z,{children:[(0,s.jsx)(A.Icon,{id:"copy-to-clipboard",title:"Copy to clipboard",size:.7,path:m,style:{marginRight:j.spacing(1)}}),x]}),(0,s.jsx)(z.Z,{sx:{margin:j.spacing(0,3)},children:g}),(0,s.jsx)(D.Z,{children:(0,s.jsxs)(y.Z,{children:[h.map((e,n)=>{var i,o;return(0,s.jsx)(b.ZP,{children:(0,s.jsxs)(c.ZP,{container:!0,alignItems:"center",children:[(0,s.jsx)(c.ZP,{item:!0,xs:4,sx:{marginRight:j.spacing(1)},children:(0,s.jsx)(N.Z,{id:"name",label:(null===(i=B[t])||void 0===i?void 0:i.name)||"Name",fullWidth:!0,variant:"outlined",value:e.name,onChange:e=>{let t=F().cloneDeep(h);console.log("Update name:",n,t,t[n]),t&&t[n]&&(t[n].name=e.target.value,p(t))}})}),(0,s.jsx)(c.ZP,{item:!0,xs:!0,sx:{marginLeft:j.spacing(1)},children:(0,s.jsx)(N.Z,{id:"value",label:(null===(o=B[t])||void 0===o?void 0:o.value)||"Value",fullWidth:!0,variant:"outlined",value:e.value,onChange:e=>{let t=F().cloneDeep(h);console.log("Update value:",n,t,t[n]),t&&t[n]&&(t[n].value=e.target.value,p(t))}})}),(0,s.jsx)(c.ZP,{item:!0,children:(0,s.jsx)(_.Z,{"aria-label":"Remove",size:"large",onClick:()=>{let e=F().cloneDeep(h);e.splice(n,1),p(e)},children:(0,s.jsx)(A.Icon,{id:"remove-item",title:"Remove",size:.8,path:u.S6N})})})]})},n)}),(0,s.jsxs)(v.Z,{onClick:()=>{let e=F().cloneDeep(h);e.push({name:"",value:""}),p(e)},children:[(0,s.jsx)(f.Z,{children:(0,s.jsx)(A.Icon,{id:"add",title:"Add",size:1,path:u.qX5})}),(0,s.jsx)(Z.Z,{primary:"Add",secondary:"Add a new item"})]})]})}),(0,s.jsxs)(G.Z,{children:[(0,s.jsx)(L.Z,{onClick:()=>{r(!1)},color:"primary",variant:"outlined",children:"Cancel"}),(0,s.jsx)(L.Z,{onClick:()=>{r(!1),d(h)},color:"primary",variant:"outlined",children:"Save"})]})]})},J=function(e){let{keyIn:t,valueIn:n,handleChanged:i}=e,[a,r]=(0,o.useState)(!1),[d,h]=(0,o.useState)(!1),[p,x]=(0,o.useState)(n);function g(e){x(e.target.value)}let m=(0,o.useMemo)(()=>n!==p,[n,p]),{name:y,description:j,icon:O,containerDisabled:R,isList:W,isPassword:z,minimum:D}=H[t],G=(0,l.Z)();return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e=>{let{children:t}=e;return W?(0,s.jsx)(v.Z,{onClick:()=>r(!0),children:t}):(0,s.jsx)(b.ZP,{children:t})},{children:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(f.Z,{children:(0,s.jsx)(A.Icon,{id:"icon",title:y,size:1,path:O})}),(0,s.jsx)(Z.Z,{primary:y,secondary:j,sx:{maxWidth:"64%",userSelect:"none"}}),W?"":(0,s.jsx)(w.Z,{sx:{maxHeight:"100%",width:420,textAlign:"end"},children:(0,s.jsxs)(c.ZP,{container:!0,alignItems:"center",justifyContent:"flex-end",wrap:"nowrap",children:[(0,s.jsx)(c.ZP,{item:!0,children:"boolean"==typeof p?(0,s.jsx)(S.Z,{edge:"end",disabled:R,checked:p,onChange:function(e,t){x(t)}}):"string"==typeof n&&"api_token"===t?(0,s.jsx)(P.Z,{fullWidth:!0,variant:"outlined",sx:{minWidth:420},children:(0,s.jsx)(I.Z,{type:"text",disabled:!0,value:p,endAdornment:(0,s.jsxs)(C.Z,{position:"end",children:[(0,s.jsx)(_.Z,{"aria-label":"Generate Token",onClick:function(){x((0,k.Z)())},edge:"end",size:"large",sx:{margin:G.spacing(-1,-.5)},children:(0,s.jsx)(A.Icon,{id:"generate-token",title:"Generate Token",size:1,path:u.VmU})}),(0,s.jsx)(_.Z,{"aria-label":"Copy to clipboard",onClick:()=>(0,T.X)(String(p)),size:"large",sx:{margin:G.spacing(-1,-.5)},children:(0,s.jsx)(A.Icon,{id:"copy-to-clipboard",title:"Copy to clipboard",size:.8,path:u.a0Z})})]})})}):"string"==typeof n&&"string"==typeof p&&"log_level"===t?(0,s.jsx)(E.Z,{id:t,options:["DEBUG","INFO","WARNING","ERROR","CRITICAL"],renderInput:e=>(0,s.jsx)(N.Z,{...e,variant:"outlined"}),onChange:function(e,t){t&&x(t)},sx:{width:210},value:p}):"string"==typeof n&&z?(0,s.jsx)(P.Z,{variant:"outlined",children:(0,s.jsx)(I.Z,{type:d?"text":"password",defaultValue:p,onChange:g,endAdornment:(0,s.jsx)(C.Z,{position:"end",children:(0,s.jsx)(_.Z,{"aria-label":"Toggle visibility",onClick:function(){h(!d)},onMouseDown:function(e){e.preventDefault()},size:"large",children:(0,s.jsx)(A.Icon,{id:"copy-to-clipboard",title:"Copy to clipboard",size:.8,path:d?u.rgx:u.DqW})})})})}):"string"==typeof n?(0,s.jsx)(N.Z,{type:"text",defaultValue:p,disabled:R,onChange:g,variant:"outlined"}):"number"==typeof n?(0,s.jsx)(N.Z,{error:!!D&&Number(p)<D,type:"number",disabled:R,inputProps:{minimum:D},defaultValue:p,onChange:g,variant:"outlined"}):""}),(0,s.jsx)(c.ZP,{item:!0,children:(0,s.jsx)(_.Z,{disabled:!1===m,onClick:()=>{i(p)},sx:{margin:G.spacing(1)},children:(0,s.jsx)(A.Icon,{id:"save",title:"Save",size:1,path:u.JTj,style:{opacity:m?1:.25}})})})]})})]})}),W&&Array.isArray(p)?(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(U,{id:t,setting:H[t],listIn:p,open:a,setOpen:r,handleChanged:e=>{x(e),i(JSON.stringify(e))}})}):""]})};let H={api_port:{name:"API Port",description:"Port for the API and WebSocket",icon:u.A0p},api_token:{name:"API Token",description:"Token for the API and WebSocket",icon:u.eLz},autostart:{name:"Autostart",description:"Automatically start the application on startup",icon:u.USr},log_level:{name:"Log Level",description:"Log level for the application",icon:u.eLz},directories:{name:"Additional Media Directories",description:"Additional media directories for the media endpoint",icon:u.Rmq,isList:!0},keyboard_hotkeys:{name:"Keyboard Hotkeys",description:"Setup hotkeys for triggering actions",icon:u.Wpj,isList:!0}};var M=function(){let[e,t]=(0,p.r)(),[n,a]=(0,o.useState)(!1),r=(0,h.useRouter)().query,u=(0,o.useCallback)(e=>{console.log("New event:",e),"SETTINGS_RESULT"===e.type&&t(e.data)},[t]),g=(0,o.useCallback)((e,t)=>{console.log("Setup WebSocketConnection"),(i=new x.C(e,t,async()=>{i.getSettings()})).onEvent=e=>u(e)},[u]),m=(0,o.useCallback)(n=>{i.updateSettings(n),t(e)},[e,t]);(0,o.useEffect)(()=>{!n&&r&&r.token&&(a(!0),g(Number(r.apiPort)||9170,String(r.token)))},[n,g,r]);let y=(0,l.Z)();return(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(c.ZP,{container:!0,direction:"column",spacing:2,alignItems:"stretch",sx:{marginBottom:y.spacing(8),padding:y.spacing(2)},children:e?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(j,{name:"API",description:"API settings",children:(0,s.jsx)(J,{keyIn:"api_port",valueIn:e.api.port,handleChanged:t=>m({...e,api:{...e.api,port:t}})})}),(0,s.jsxs)(j,{name:"General",description:"General settings",children:[(0,s.jsx)(J,{keyIn:"autostart",valueIn:e.autostart,handleChanged:t=>m({...e,autostart:t})}),(0,s.jsx)(J,{keyIn:"log_level",valueIn:e.log_level,handleChanged:t=>m({...e,log_level:t})})]}),(0,s.jsx)(j,{name:"Keyboard",description:"Keyboard settings",children:(0,s.jsx)(J,{keyIn:"keyboard_hotkeys",valueIn:e.keyboard_hotkeys,handleChanged:t=>m({...e,keyboard_hotkeys:t})})}),(0,s.jsx)(j,{name:"Media",description:"Media settings",children:(0,s.jsx)(J,{keyIn:"directories",valueIn:e.media.directories,handleChanged:t=>m({...e,media:{...e.media,directories:t}})})})]}):(0,s.jsx)(c.ZP,{container:!0,direction:"row",justifyContent:"center",sx:{margin:y.spacing(2,0,10)},children:(0,s.jsx)(d.Z,{})})})})},V=function(){return(0,s.jsx)(r.Z,{title:"Settings",url:"https://system-bridge.timmo.dev",description:"Frontend for System Bridge",children:(0,s.jsx)(a.Z,{component:"article",maxWidth:"xl",children:(0,s.jsx)(M,{})})})}}},function(e){e.O(0,[702,662,870,908,8,699,373,561,826,888,774,179],function(){return e(e.s=4768)}),_N_E=e.O()}]);