"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[763],{4626:function(e,t,n){n.d(t,{Z:function(){return j}});var s=n(5893),o=n(7294),i=n(1163),r=n(9008),a=n.n(r),l=n(3946),c=n(8849),u=n(5317),d=n(8298),m=n(2734),h=n(2293),p=n(5582),x=n(155),g=n(6886),k=n(9417),v=n(5861),b=n(5616);function y(e){let{children:t}=e,n=(0,d.Z)({disableHysteresis:!0,threshold:24});return(0,o.cloneElement)(t,{elevation:n?4:0})}var f=function(){let e=(0,m.Z)();return(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(y,{children:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(h.Z,{color:"transparent",elevation:0,children:(0,s.jsx)(p.Z,{maxWidth:"xl",sx:{padding:0},children:(0,s.jsx)(x.Z,{sx:{minHeight:50,maxHeight:50,padding:0,flex:1,alignItems:"center",justifyContent:"space-between",display:"flex",flexWrap:"nowrap"},children:(0,s.jsx)(g.ZP,{item:!0,children:(0,s.jsx)(k.Z,{href:"https://system-bridge.timmo.dev",target:"_blank",children:(0,s.jsx)(v.Z,{component:"div",variant:"h4",sx:{textTransform:"none",userSelect:"none",color:e.palette.primary.contrastText},children:"System Bridge"})})})})})}),(0,s.jsx)(b.Z,{sx:{height:e.spacing(10)}})]})})})};let w=!1;var j=function(e){let t=(0,i.useRouter)();return(0,o.useEffect)(()=>{if(t.isReady&&!w){var e,n,s,o;w=!0;let i=(null===(e=t.query)||void 0===e?void 0:e.token)||"",r=(null===(n=t.query)||void 0===n?void 0:n.apiPort)||"9170",a=!1;if((null===(s=t.query)||void 0===s?void 0:s.token)||(a=!0,i=window.prompt("Please enter your Token",i)),(null===(o=t.query)||void 0===o?void 0:o.apiPort)||(a=!0,r=window.prompt("Please enter your API port (default: 9170)",r)),a&&i&&r){let e=t.asPath.split("?")[0];t.replace({pathname:e.includes(".html")?e:"".concat(e,".html"),query:{...t.query,token:i,apiPort:r}})}}},[t]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(a(),{children:[(0,s.jsx)("title",{children:e.title?"".concat(e.title," - System Bridge"):"System Bridge"}),(0,s.jsx)("link",{rel:"canonical",href:e.url}),(0,s.jsx)("meta",{name:"description",content:e.description?"".concat(e.description):e.title?"".concat(e.title," - System Bridge"):"System Bridge"}),(0,s.jsx)("meta",{name:"keywords",content:e.keywords?"".concat(e.keywords):"system-bridge, system, bridge, typescript"})]}),!e.noHeader&&(0,s.jsx)(f,{}),e.closeButton&&(0,s.jsx)(l.Z,{size:"small",sx:{position:"absolute",top:4,right:4,zIndex:1e3},onClick:()=>{window.location.href="http://close.window"},children:(0,s.jsx)(c.Icon,{id:"close",path:u.r5M,size:1})}),e.children]})}},8433:function(e,t,n){n.d(t,{D:function(){return i},X:function(){return o}});var s=n(7294);function o(e){navigator.permissions.query({name:"clipboard-write"}).then(t=>{("granted"===t.state||"prompt"===t.state)&&navigator.clipboard.writeText(e)})}function i(e){let t=(0,s.useRef)();return(0,s.useEffect)(()=>{t.current=e}),t.current}},8833:function(e,t,n){n.d(t,{C:function(){return o}});var s=n(7632);class o{close(){this.websocket&&this.websocket.readyState===this.websocket.OPEN&&this.websocket.close()}async connect(){let e=new WebSocket("ws://".concat(window.location.hostname||"localhost",":").concat(this.port,"/api/websocket"));return await new Promise(t=>{e.onopen=()=>t()}),e.onmessage=e=>{if("string"==typeof e.data){let t=JSON.parse(e.data);t&&this.onEvent&&this.onEvent(t)}},e}isConnected(){var e;return(null===(e=this.websocket)||void 0===e?void 0:e.readyState)===WebSocket.OPEN}getData(e){this.websocket&&this.websocket.readyState===this.websocket.OPEN&&(console.log("Get data:",e),this.websocket.send(JSON.stringify({id:(0,s.Z)(),token:this.token,event:"GET_DATA",data:{modules:e}})))}getSettings(){this.websocket&&this.websocket.readyState===this.websocket.OPEN&&(console.log("Get settings"),this.websocket.send(JSON.stringify({id:(0,s.Z)(),token:this.token,event:"GET_SETTINGS",data:{}})))}registerDataListener(e){this.websocket&&this.websocket.readyState===this.websocket.OPEN&&(console.log("Register data listener:",e),this.websocket.send(JSON.stringify({id:(0,s.Z)(),token:this.token,event:"REGISTER_DATA_LISTENER",data:{modules:e}})))}sendPlayerStatus(e){this.websocket&&this.websocket.readyState===this.websocket.OPEN&&this.websocket.send(JSON.stringify({id:(0,s.Z)(),token:this.token,event:"MEDIA_STATUS",data:{status:e}}))}updateSettings(e){this.websocket&&this.websocket.readyState===this.websocket.OPEN&&(console.log("Update setting:",e),this.websocket.send(JSON.stringify({id:(0,s.Z)(),token:this.token,event:"UPDATE_SETTINGS",data:e})))}constructor(e,t,n){this.port=e||9170,this.token=t,(async()=>{this.websocket=await this.connect(),n&&this.websocket&&this.websocket.readyState===this.websocket.OPEN&&n()})()}}},8792:function(e,t,n){let s;n.d(t,{Z:function(){return M}});var o=n(5893),i=n(7294),r=n(3035),a=n(361),l=n.n(a),c=n(8446),u=n.n(c),d=n(8813),m=n(8433),h=n(8833),p=n(2734),x=n(6886),g=n(5616),k=n(2022),v=n(6628),b=n(5861),y=n(3946),f=n(1050),w=n(8849),j=n(5317),S=n(381),P=n.n(S),E=n(6310),Z=n.n(E),C=function(){let[e,t]=(0,d.nn)(),[n,s]=(0,i.useState)(!1),[r,a]=(0,d.XI)(),l=(0,i.useRef)(null),{duration:c,playing:u,muted:m,loaded:h,position:S,volume:E}=(0,i.useMemo)(()=>e,[e]),C=(0,i.useMemo)(()=>"".concat((100*E).toFixed(0),"%"),[E]),I=(0,i.useMemo)(()=>{let e=P().duration(S,"seconds");return"".concat(e.minutes().toString().padStart(2,"0"),":").concat(e.seconds().toString().padStart(2,"0"))},[S]),M=(0,i.useMemo)(()=>{let e=P().duration(c,"seconds");return"".concat(e.minutes().toString().padStart(2,"0"),":").concat(e.seconds().toString().padStart(2,"0"))},[c]),{artist:N,album:_,cover:T,source:D,title:O}=(0,i.useMemo)(()=>e.source,[e]),A=(0,i.useCallback)(n=>{t({...e,loaded:n})},[e,t]),L=(0,i.useCallback)(n=>{t({...e,playing:n})},[e,t]),U=(0,i.useCallback)(()=>{L(!u)},[u,L]),R=(0,i.useCallback)(n=>{t({...e,muted:n})},[e,t]),W=(0,i.useCallback)(()=>{R(!m)},[m,R]),q=(0,i.useCallback)((n,s)=>{let o="down"===s?E-n:"up"===s?E+n:n;o>1&&(o=1),o<0&&(o=0),t({...e,volume:o}),m&&R(!1)},[m,E,e,t,R]),z=(0,i.useCallback)(n=>{t({...e,duration:n})},[e,t]),F=(0,i.useCallback)(n=>{c&&n>c&&(n=c),n<0&&(n=0),t({...e,position:n})},[e,c,t]),G=(0,i.useCallback)(e=>{var t;null===(t=l.current)||void 0===t||t.seekTo(e,"seconds"),s(!1),u||L(!0)},[u,L]);function B(){L(!1),s(!0)}function J(){S&&G(S)}(0,i.useEffect)(()=>{h||A(!0)},[h,A,L]);let H=(0,p.Z)();return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(Z(),{ref:l,height:"0px",width:"0px",muted:m,playing:u,stopOnUnmount:!0,url:D,volume:E,onDuration:e=>{z(e)},onPause:()=>{L(!1)},onPlay:()=>{L(!0)},onStart:()=>{L(!0)},onProgress:e=>{let{playedSeconds:t}=e;n||F(t)}}),(0,o.jsxs)(x.ZP,{container:!0,direction:"row",alignItems:"center",justifyItems:"center",wrap:"nowrap",sx:{height:140,width:540,overflow:"hidden"},children:[(0,o.jsx)(x.ZP,{item:!0,sx:{width:140,margin:H.spacing(0,1,0,0)},children:(0,o.jsx)(g.Z,{ref:r,children:(0,o.jsxs)(k.Z,{"aria-label":u?"Pause":"Play",onClick:U,children:[(0,o.jsx)("img",{alt:"".concat(N," - ").concat(_),src:T||"https://raw.githubusercontent.com/timmo001/system-bridge/master/resources/system-bridge-dimmed.svg",width:140}),(0,o.jsx)(v.Z,{in:!!a,timeout:{enter:200,exit:400},children:(0,o.jsx)(g.Z,{sx:{position:"absolute",display:"flex",height:"100%",width:"100%",zIndex:100},children:(0,o.jsx)(w.Icon,{id:u?"pause":"play",path:u?j.Wa1:j._86,size:6,style:{position:"relative",margin:"auto"}})})})]})})}),(0,o.jsx)(x.ZP,{item:!0,xs:!0,children:(0,o.jsxs)(x.ZP,{container:!0,direction:"column",alignItems:"flex-start",justifyItems:"space-around",children:[(0,o.jsx)(x.ZP,{item:!0,children:(0,o.jsxs)(b.Z,{color:"textPrimary",component:"span",variant:"subtitle1",noWrap:!0,children:[N," - ",O]})}),(0,o.jsx)(x.ZP,{item:!0,children:(0,o.jsx)(b.Z,{color:"textSecondary",component:"span",variant:"subtitle2",noWrap:!0,children:_})}),(0,o.jsxs)(x.ZP,{item:!0,container:!0,alignContent:"center",children:[(0,o.jsx)(x.ZP,{item:!0,xs:4}),(0,o.jsx)(x.ZP,{sx:{margin:H.spacing(0,1,0,0)},item:!0,children:(0,o.jsx)(y.Z,{size:"small",onClick:W,children:m?(0,o.jsx)(w.Icon,{id:"mute",path:j.PLS,size:1.25}):(0,o.jsx)(w.Icon,{id:"unmute",path:j.dw,size:1.25})})}),(0,o.jsx)(x.ZP,{sx:{margin:H.spacing(.6,2,0,0)},item:!0,xs:!0,children:(0,o.jsx)(f.ZP,{min:0,max:1,step:.01,value:E,onChange:(e,t)=>{"number"==typeof t&&q(t)}})}),(0,o.jsx)(x.ZP,{sx:{margin:H.spacing(.9,E>=1?1:2,0,0)},item:!0,children:(0,o.jsx)(b.Z,{component:"span",variant:"body2",children:C})})]}),(0,o.jsxs)(x.ZP,{container:!0,children:[(0,o.jsx)(x.ZP,{sx:{margin:H.spacing(.25,2,0,0)},item:!0,children:(0,o.jsx)(b.Z,{component:"span",variant:"body2",children:I})}),(0,o.jsx)(x.ZP,{sx:{margin:H.spacing(0,2,0,0)},item:!0,xs:!0,children:(0,o.jsx)(f.ZP,{min:0,max:c,step:.1,value:S,valueLabelDisplay:"off",onMouseDown:B,onKeyDown:B,onChange:function(e,t){F(t)},onMouseUp:J,onKeyUp:J})}),(0,o.jsx)(x.ZP,{sx:{margin:H.spacing(.25,1,0,0)},item:!0,children:(0,o.jsx)(b.Z,{component:"span",variant:"body2",children:M})})]})]})})]})]})},I=function(){let[e,t]=(0,d.nn)(),{autoplay:n,duration:s,playing:r,muted:a,loaded:l,volume:c}=(0,i.useMemo)(()=>e,[e]),{source:u}=(0,i.useMemo)(()=>e.source,[e]),m=(0,i.useCallback)(n=>{t({...e,loaded:n})},[e,t]),h=(0,i.useCallback)(n=>{console.log("Set playing:",n),t({...e,playing:n})},[e,t]),p=(0,i.useCallback)(n=>{t({...e,muted:n})},[e,t]);(0,i.useCallback)((n,s)=>{let o="down"===s?c-n:"up"===s?c+n:n;o>1&&(o=1),o<0&&(o=0),t({...e,volume:o}),a&&p(!1)},[a,c,e,t,p]);let x=(0,i.useCallback)(n=>t({...e,duration:n}),[e,t]),g=(0,i.useCallback)(n=>{s&&n>s&&(n=s),n<0&&(n=0),t({...e,position:n})},[e,s,t]);return(0,i.useEffect)(()=>{l||m(!0)},[l,m]),(0,o.jsx)(o.Fragment,{children:(0,o.jsx)(Z(),{autoPlay:n,controls:!0,height:"270px",width:"480px",playsinline:!0,muted:a,playing:r,url:u,volume:c,style:{position:"absolute",top:"0",left:"0",overflow:"hidden"},onReady:()=>{console.log("Autoplay:",n),h(n||!1)},onDuration:e=>x(e),onPause:()=>h(!1),onPlay:()=>h(!0),onStart:()=>h(!0),onProgress:e=>{let{playedSeconds:t}=e;return g(t)}})})},M=function(e){let{playerType:t}=e,[n,a]=(0,i.useState)(!1),[c,p]=(0,d.nn)(),x=(0,m.D)(c),g=(0,r.useRouter)(),k=g.query,v=(0,i.useCallback)(e=>{switch(console.log("Event:",e),e.type){case"MEDIA_PAUSE":p({...c,playing:!1});break;case"MEDIA_PLAY":p({...c,playing:!0});break;case"MEDIA_VOLUME_DOWN":e.volume&&p({...c,volume:c.volume-e.volume});break;case"MEDIA_VOLUME_UP":e.volume&&p({...c,volume:c.volume+e.volume});break;case"MEDIA_VOLUME_SET":e.volume&&p({...c,volume:e.volume});break;case"MEDIA_VOLUME_SET":e.position&&p({...c,position:e.position})}},[c,p]),b=(0,i.useCallback)((e,t)=>{console.log("Setup WebSocketConnection"),(s=new h.C(e,t,async()=>{console.log("Connected to WebSocket")})).onEvent=v},[v]);(0,i.useEffect)(()=>{!n&&k&&k.token&&(a(!0),b(Number(k.apiPort)||9170,String(k.token)))},[n,b,k]),(0,i.useEffect)(()=>{if(!c&&g.isReady){var e,n;let s=Number(k.volume);switch(t){default:break;case"audio":p({autoplay:(null===(e=k.autoplay)||void 0===e?void 0:e.toLowerCase())==="true",muted:!1,playing:!1,loaded:!1,position:0,duration:1,source:{type:"audio",source:k.url,album:k.album||"Unknown Album",artist:k.artist||"Unknown Aritst",cover:k.cover,title:k.title||"Unknown Title",volumeInitial:(s>0?s:40)/100},volume:(s>0?s:40)/100});break;case"video":p({autoplay:(null===(n=k.autoplay)||void 0===n?void 0:n.toLowerCase())==="true",muted:!1,playing:!1,loaded:!1,position:0,duration:1,source:{type:"video",source:String(k.url),volumeInitial:(s>0?s:40)/100},volume:(s>0?s:40)/100})}}},[c,p,t,g,k]),(0,i.useEffect)(()=>{if(c){let e;x&&"audio"===(e=l()(x)).source.type&&delete e.source.cover;let t=l()(c);if("audio"===t.source.type&&delete t.source.cover,!u()(t,e)){if(console.log("Player update\n\npreviousStatus:",e,"\nnewStatus:",t),!t.loaded||!s)return;if(!s.isConnected()){a(!1),console.warn("WebSocket not connected");return}s.sendPlayerStatus(t)}}},[c,x]);let y=(0,i.useMemo)(()=>{if(c)return c.source.type},[c]);return(0,o.jsx)(o.Fragment,{children:"audio"===y?(0,o.jsx)(C,{}):"video"===y?(0,o.jsx)(I,{}):""})}},8813:function(e,t,n){n.d(t,{I0:function(){return a},XI:function(){return c},nn:function(){return l}});var s=n(5893),o=n(7294);let i=(0,o.createContext)(void 0),r=(0,o.createContext)(null),a=e=>{let{children:t}=e,[n,a]=(0,o.useState)();return(0,s.jsx)(r.Provider,{value:a,children:(0,s.jsx)(i.Provider,{value:n,children:t})})},l=()=>{let e=(0,o.useContext)(i),t=(0,o.useContext)(r);if(null===t)throw Error();return[e,t]};function c(){let[e,t]=o.useState(!1),n=o.useCallback(()=>t(!0),[]),s=o.useCallback(()=>t(!1),[]),i=o.useRef();return[o.useCallback(e=>{i.current&&(i.current.removeEventListener("mouseover",n),i.current.removeEventListener("mouseout",s)),i.current=e,i.current&&(i.current.addEventListener("mouseover",n),i.current.addEventListener("mouseout",s))},[n,s]),e]}}}]);